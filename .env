# =====================
# Database / Server
# =====================
DATABASE_URL=postgresql://app_user:123@localhost:5432/app_db
PORT=3000

# =====================
# Scheduler
# =====================
SCHEDULER_TZ=Asia/Shanghai

# Legacy (v1) scheduler — every 10s (keep only if you still use the old scheduler)
CRON_SCHEDULE=*/10 * * * * *

# V2 scheduler — once per hour at :00
CRON_SCHEDULE_V2=0 0 * * * *

# Advisory locks (prevent dup runs)
SCHEDULER_LOCK_KEY=42843
ANALYZE_LOCK_KEY=972115

# Debounce: block a second prediction if one happened within N seconds
PRED_DEBOUNCE_SEC=15

# =====================
# OpenAI / Model
# =====================
OPENAI_API_KEY=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
PRED_MODEL=gpt-4.1-mini
PRED_TEMPERATURE=0.7

# =====================
# Prediction scope / lookback
# =====================
PRED_LOOKBACK=all
PRED_TOPK=5

# (Old throttle var; replaced by PRED_DEBOUNCE_SEC)
# PRED_MIN_SECONDS=40   # <-- remove or ignore

# =====================
# Reversal detection
# =====================
REVERSAL_SHORT_MIN=10
REVERSAL_LONG_MIN=60
REVERSAL_DELTA=0.10
TREND_TTL_SEC=60

# =====================
# Transitions / learning
# =====================
TRANSITIONS_MIN_COUNT=2

# =====================
# Timing rules
# =====================
FIRST_PREDICT_DELAY_MIN=20
PRED_PAUSE_AFTER_WRONGS=3
PRED_PAUSE_MIN=15

# =====================
# AI trigger limits
# =====================
AI_MAX_PER_DAY=30
AI_MIN_GAP_HOURS=0.25
AI_MAX_PER_WINDOW=1
AI_STREAK_MAX_WRONGS=3
AI_STREAK_COOLDOWN_MIN=120

# =====================
# Observation stability
# =====================
OBSERVE_LOOKBACK=30
OBSERVE_MAX_RUN=3
OBSERVE_MIN_COLORS=5

# =====================
# Deviation / caches
# =====================
DEVIATION_TTL_SEC=60

# =====================
# Scoring weights
# =====================
W_GAP_PRESSURE=0.22
W_STREAK_BREAK=0.18
W_COLOR_BALANCE=0.14
W_PARITY_ROTATION=0.18      # <- fixed typo (was W_PARITY_ROTATIONSoy)
W_SIZE_REGIME=0.18
W_REACTIVATION=0.10
W_QUAD_PARITY=0.08
W_TREND_REVERSAL=0.06
